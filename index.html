<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Neon Pulse Visualizer</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/addons/p5.sound.min.js"></script>
  <style>
    body { margin: 0; padding: 0; overflow: hidden; background: #050505; }
    canvas { display: block; }
    #overlay {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      display: flex; align-items: center; justify-content: center;
      color: white; font-family: sans-serif; font-size: 24px;
      background: rgba(0,0,0,0.8); cursor: pointer; z-index: 10;
    }
  </style>
</head>
<body>

<div id="overlay">Click to Start the Vibe</div>

<script>
  let song;
  let amplitude;
  let displayText = "DROP THE BEAT"; 
  let spacing = 30; // Space between repeated text
  
  function preload() {
    song = loadSound('mysong.mp3'); 
  }

  function setup() {
    createCanvas(windowWidth, windowHeight);
    amplitude = new p5.Amplitude();
    textAlign(CENTER, CENTER);
    rectMode(CENTER);
    
    // LOWER VOLUME HERE (0.0 to 1.0)
    song.setVolume(0.3); 

    let overlay = document.getElementById('overlay');
    overlay.addEventListener('click', () => {
      if (!song.isPlaying()) {
        song.play();
        overlay.style.display = 'none';
      }
    });
  }

  function draw() {
    background(10, 10, 15); // Very dark blue/black

    let level = amplitude.getLevel();
    let speed = 2;
    
    // 1. BACKGROUND (Seamless Infinite Scroll)
    textSize(40);
    noStroke();
    
    // Calculate how wide one "unit" of text is
    let unitWidth = textWidth(displayText) + spacing;
    
    // How many copies do we need to cover the screen?
    let copies = width / unitWidth + 2; 

    let rowHeight = 60;
    let totalRows = height / rowHeight + 2;

    for (let i = 0; i < totalRows; i++) {
      let y = i * rowHeight;
      
      // Alternate direction
      let direction = (i % 2 === 0) ? 1 : -1; 
      
      // Calculate seamless offset
      // This math ensures it wraps perfectly based on text width, not screen width
      let currentOffset = (frameCount * speed * direction) % unitWidth;
      
      // If moving left (negative), we need to shift starting position so it doesn't snap
      if (direction === -1 && currentOffset > 0) currentOffset -= unitWidth;

      // Glow effect for background (subtle)
      drawingContext.shadowBlur = 10;
      drawingContext.shadowColor = color(255, 255, 255, 50);
      fill(255, 255, 255, 30); 

      // Draw the row of text
      for (let j = -1; j < copies; j++) {
        let x = (j * unitWidth) + currentOffset;
        text(displayText, x, y);
      }
    }

    // 2. CENTER PULSATING TEXT (With Neon Glow)
    let scaleFactor = map(level, 0, 0.3, 1, 3.5); 
    scaleFactor = constrain(scaleFactor, 1, 4);

    translate(width / 2, height / 2);
    scale(scaleFactor);
    
    // Strong Neon Glow
    // Map the blur strength to the music volume
    let glowStrength = map(level, 0, 0.3, 20, 100);
    drawingContext.shadowBlur = glowStrength;
    drawingContext.shadowColor = color(0, 255, 200); // Neon Cyan Color

    // Text style
    fill(255); 
    stroke(0, 255, 200);
    strokeWeight(2);
    textSize(80);
    text(displayText, 0, 0);
    
    // Reset glow so it doesn't mess up other things in next frame
    drawingContext.shadowBlur = 0; 
  }

  function windowResized() {
    resizeCanvas(windowWidth, windowHeight);
  }
</script>

</body>
</html>