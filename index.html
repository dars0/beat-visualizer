<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Music Visualizer</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/addons/p5.sound.min.js"></script>
  <style>
    body { margin: 0; padding: 0; overflow: hidden; background: #000; }
    canvas { display: block; }
    #overlay {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      display: flex; align-items: center; justify-content: center;
      color: white; font-family: sans-serif; font-size: 24px;
      background: rgba(0,0,0,0.8); cursor: pointer; z-index: 10;
    }
  </style>
</head>
<body>

<div id="overlay">Click anywhere to start music</div>

<script>
  let song;
  let amplitude;
  let displayText = "DROP THE BEAT"; // CHANGE THIS TEXT
  let font;
  
  // Load your song here. Ensure the file is in the same folder as this index.html
  function preload() {
    // Replace 'mysong.mp3' with your actual music file name
    song = loadSound('mysong.mp3'); 
  }

  function setup() {
    createCanvas(windowWidth, windowHeight);
    amplitude = new p5.Amplitude();
    textAlign(CENTER, CENTER);
    rectMode(CENTER);
    
    // Hide overlay and play music on click
    let overlay = document.getElementById('overlay');
    overlay.addEventListener('click', () => {
      if (!song.isPlaying()) {
        song.play();
        overlay.style.display = 'none';
      }
    });
  }

  function draw() {
    background(20); // Dark grey background

    let level = amplitude.getLevel(); // Get volume (0.0 to 1.0)
    
    // 1. DRAW BACKGROUND (Scrolling Rows)
    textSize(40);
    fill(255, 255, 255, 50); // White with low opacity (transparency)
    noStroke();
    
    let speed = 2;
    let rowHeight = 60;
    let totalRows = height / rowHeight + 2;
    
    for (let i = 0; i < totalRows; i++) {
      let y = i * rowHeight;
      // Alternate direction: Even rows go right, Odd rows go left
      let direction = (i % 2 === 0) ? 1 : -1; 
      
      // Calculate movement based on frameCount
      let xOffset = (frameCount * speed * direction) % width;
      
      // Draw text multiple times to fill the row width
      let textW = textWidth(displayText + "   ");
      let repeats = width / textW + 4; // Add extra to cover edges
      
      for (let j = -2; j < repeats; j++) {
        let x = j * textW + xOffset;
        text(displayText, x, y);
      }
    }

    // 2. DRAW CENTER PULSATING TEXT
    // Map volume level (usually 0.0 to 0.3) to a size scale
    let scaleFactor = map(level, 0, 0.3, 1, 2.5); 
    // Constrain it so it doesn't get too crazy
    scaleFactor = constrain(scaleFactor, 1, 3);

    translate(width / 2, height / 2); // Move to center
    scale(scaleFactor); // Apply the pulse size
    
    // Cool neon styling
    stroke(255, 0, 100);
    strokeWeight(4);
    fill(255);
    textSize(80);
    text(displayText, 0, 0);
  }

  function windowResized() {
    resizeCanvas(windowWidth, windowHeight);
  }
</script>

</body>
</html>